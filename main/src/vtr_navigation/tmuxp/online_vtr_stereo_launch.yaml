# The tmux session name, has to be unique
session_name: online_vtr_stereo

# environment:
#   ROS_DOMAIN_ID: "1"
#   PRIORITIZE: nice -n -5 ionice -c 2 -n 1

# Can run a script before tmuxp starts building the session
# before_script: /my/startup/script
shell_command_before:
  - "source ${VTRVENV}/bin/activate"
  - "source ${VTRSRC}/main/install/setup.bash"

# The default start directory for the full session, ./ is this file's location
start_directory: ${VTRDATA}

# Add commands to bash history
suppress_history: false

# This is where we list all the stuff we want to run
windows:
  - window_name: vtr_main
    layout: main-horizontal
    panes:
      - ros2 launch vtr_navigation vtr_stereo.launch.py scenario_params:=online.yaml data_dir:=${VTRDATA}/online-test/$(date '+%F')/$(date '+%F')_main clear_data_dir:=false
      # - ros2 run vtr_mission_planning vtr_mission.py --help # backup way to send commands if UI not working

      - ssh -t administrator@192.168.131.1 "source ~/ros2_crystal/install/setup.bash && ros2 run ros1_bridge static_bridge_grizzly" # run ROS1/ROS2 bridge on Grizzly
      # - ros2 run rviz2 rviz2 -d ~/.rviz2/stereo.rviz

  - window_name: ui
    layout: main-horizontal
    panes:
      - sleep 2 && ros2 run vtr_ui socket_client  --ros-args -r __ns:=/vtr # wait for the socket_server to be created
      - ros2 run vtr_ui web_server  --ros-args -r __ns:=/vtr
      - ros2 run vtr_ui socket_server  --ros-args -r __ns:=/vtr
      # - sleep 5 && firefox --new-window "localhost:5200" # the webpage has to wait for everything above

  - window_name: system_monitor
    layout: main-horizontal
    panes:
      - ros2 launch vtr_safety_monitor safety_monitor.launch.py scenario_params:=default.yaml
      - ssh -t administrator@192.168.131.1 "source /opt/ros/kinetic/setup.bash && rostopic echo /mcu/status" # to monitor Grizzly battery voltage while testing
      - echo "backup terminal"

  - window_name: grizzly
    layout: main-horizontal
    panes:
      - ros2 launch vtr_grizzly grizzly_utias_description.launch.py # to get vehicle/sensor transforms
      - ros2 launch asrl__grizzly wired-grizzly_xbox_js0.launch # XBox controller for manually driving
      # - echo 'ros2 topic echo /grizzly_velocity_controller/cmd_vel # monitor velocity commands'
      # - ssh -t administrator@192.168.131.1 "source ~/ros2_crystal/install/setup.bash && ros2 run ros1_bridge static_bridge_grizzly"             # run ROS1/ROS2 bridge on Grizzly

  - window_name: camera
    layout: main-horizontal
    panes:
      - ros2 run vtr_sensors BumblebeeDriver --ros-args --params-file ${VTRSRC}/main/src/vtr_sensors/param/XB3.yaml
      - stress -c 1 # workaround for super weird XB3 Driver bug
      # - ros2 run vtr_sensors BumblebeeRecorder ${VTRDATA}/$(date '+%s') front_xb3                  # optional to record full stereo stream
